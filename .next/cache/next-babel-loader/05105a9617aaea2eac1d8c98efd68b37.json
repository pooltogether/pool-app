{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useContext, useEffect, useState } from 'react';\nimport FeatherIcon from 'feather-icons-react';\nimport { ethers } from 'ethers';\nimport { useRouter } from 'next/router';\nimport { useAtom } from 'jotai';\nimport IERC20Abi from '@pooltogether/pooltogether-contracts/abis/IERC20';\nimport { Trans, useTranslation } from 'lib/../i18n';\nimport { AuthControllerContext } from 'lib/components/contextProviders/AuthControllerContextProvider';\nimport { PoolDataContext } from 'lib/components/contextProviders/PoolDataContextProvider';\nimport { transactionsAtom } from 'lib/atoms/transactionsAtom';\nimport { Button } from 'lib/components/Button';\nimport { ButtonDrawer } from 'lib/components/ButtonDrawer';\nimport { DepositTxButton } from 'lib/components/DepositTxButton';\nimport { DepositFormUsersBalance } from 'lib/components/DepositFormUsersBalance';\nimport { PaneTitle } from 'lib/components/PaneTitle';\nimport { PoolNumber } from 'lib/components/PoolNumber';\nimport { PoolCurrencyIcon } from 'lib/components/PoolCurrencyIcon';\nimport { PTHint } from 'lib/components/PTHint';\nimport { TransactionsTakeTimeMessage } from 'lib/components/TransactionsTakeTimeMessage';\nimport { WyreTopUpBalanceDropdown } from 'lib/components/WyreTopUpBalanceDropdown';\nimport { useSendTransaction } from 'lib/hooks/useSendTransaction';\nimport { numberWithCommas } from 'lib/utils/numberWithCommas';\nimport { usersDataForPool } from 'lib/utils/usersDataForPool'; // import { poolTokenSupportsPermitSign } from 'lib/utils/poolTokenSupportsPermitSign'\n\nexport function DepositCryptoForm(props) {\n  _s();\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var _useAtom = useAtom(transactionsAtom),\n      _useAtom2 = _slicedToArray(_useAtom, 2),\n      transactions = _useAtom2[0],\n      setTransactions = _useAtom2[1];\n\n  var nextStep = props.nextStep,\n      previousStep = props.previousStep;\n  var router = useRouter();\n  var quantity = router.query.quantity;\n\n  var _useContext = useContext(AuthControllerContext),\n      usersAddress = _useContext.usersAddress,\n      provider = _useContext.provider;\n\n  var _useContext2 = useContext(PoolDataContext),\n      pool = _useContext2.pool,\n      usersChainData = _useContext2.usersChainData;\n\n  var decimals = pool === null || pool === void 0 ? void 0 : pool.underlyingCollateralDecimals;\n  var tokenAddress = pool === null || pool === void 0 ? void 0 : pool.underlyingCollateralToken;\n  var ticker = pool === null || pool === void 0 ? void 0 : pool.underlyingCollateralSymbol;\n  var poolAddress = pool === null || pool === void 0 ? void 0 : pool.poolAddress;\n  var tickerUpcased = ticker === null || ticker === void 0 ? void 0 : ticker.toUpperCase();\n\n  var _useState = useState(true),\n      needsApproval = _useState[0],\n      setNeedsApproval = _useState[1];\n\n  var _useState2 = useState(),\n      cachedUsersBalance = _useState2[0],\n      setCachedUsersBalance = _useState2[1];\n\n  var poolIsLocked = pool === null || pool === void 0 ? void 0 : pool.isRngRequested;\n  var quantityBN = ethers.utils.bigNumberify(0);\n\n  if (decimals) {\n    quantityBN = ethers.utils.parseUnits(quantity || '0', Number(decimals));\n  }\n\n  var _usersDataForPool = usersDataForPool(pool, usersChainData),\n      usersTokenBalanceBN = _usersDataForPool.usersTokenBalanceBN,\n      usersTokenBalance = _usersDataForPool.usersTokenBalance,\n      usersTokenAllowance = _usersDataForPool.usersTokenAllowance;\n\n  useEffect(function () {\n    setCachedUsersBalance(usersTokenBalance);\n  }, [usersTokenBalance]);\n  useEffect(function () {\n    if ( // poolTokenSupportsPermitSign(chainId, tokenAddress) ||\n    quantityBN.gt(0) && usersTokenAllowance.gte(quantityBN)) {\n      setNeedsApproval(false);\n    } else {\n      setNeedsApproval(true);\n    }\n  }, [quantityBN, usersTokenAllowance]);\n  var overBalance = false;\n\n  if (decimals) {\n    overBalance = quantity && usersTokenBalanceBN.lt(ethers.utils.parseUnits(quantity, Number(decimals)));\n  }\n\n  var _useState3 = useState(),\n      txId = _useState3[0],\n      setTxId = _useState3[1];\n\n  var txName = t(\"allowTickerPool\", {\n    ticker: tickerUpcased\n  });\n  var method = 'approve';\n\n  var _useSendTransaction = useSendTransaction(txName, transactions, setTransactions),\n      _useSendTransaction2 = _slicedToArray(_useSendTransaction, 1),\n      sendTx = _useSendTransaction2[0];\n\n  var tx = transactions === null || transactions === void 0 ? void 0 : transactions.find(function (tx) {\n    return tx.id === txId;\n  });\n  var unlockTxInFlight = !(tx === null || tx === void 0 ? void 0 : tx.cancelled) && ((tx === null || tx === void 0 ? void 0 : tx.inWallet) || (tx === null || tx === void 0 ? void 0 : tx.sent));\n\n  var handleUnlockClick = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var params, id;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              params = [poolAddress, ethers.utils.parseUnits('9999999999', Number(decimals)) // ethers.utils.parseUnits(\n              //   quantity,\n              //   Number(decimals)\n              // ),\n              // {\n              //   gasLimit: 200000\n              // }\n              ];\n              id = sendTx(t, provider, usersAddress, IERC20Abi, tokenAddress, method, params);\n              setTxId(id);\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleUnlockClick(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var approveButtonClassName = !needsApproval ? 'w-full' : 'w-48-percent';\n\n  var approveButton = __jsx(Button, {\n    textSize: \"lg\",\n    onClick: handleUnlockClick,\n    disabled: !needsApproval || unlockTxInFlight,\n    className: approveButtonClassName\n  }, !needsApproval && __jsx(React.Fragment, null, __jsx(FeatherIcon, {\n    strokeWidth: \"0.25rem\",\n    icon: \"check\",\n    className: \"inline-block relative w-5 h-5 ml-auto mr-1\",\n    style: {\n      top: '-0.05rem'\n    }\n  })), \" \", t('allowTicker', {\n    ticker: tickerUpcased\n  }));\n\n  return __jsx(React.Fragment, null, __jsx(PaneTitle, {\n    \"short\": true\n  }, __jsx(\"div\", {\n    className: \"inline-block sm:block relative -t-1 -mr-2\"\n  }, __jsx(PoolCurrencyIcon, {\n    pool: pool\n  })), \" \", t('depositTicker', {\n    ticker: tickerUpcased\n  })), __jsx(\"div\", {\n    className: \"mb-6 -mt-2\"\n  }, __jsx(PaneTitle, {\n    small: true\n  }, __jsx(Trans, {\n    i18nKey: \"amountTickets\",\n    defaults: \"<number>{{amount}}</number> tickets\",\n    components: {\n      number: __jsx(PoolNumber, null)\n    },\n    values: {\n      amount: quantity\n    }\n  }))), __jsx(\"div\", {\n    className: \"text-sm xs:text-base sm:text-lg lg:text-xl\"\n  }, __jsx(DepositFormUsersBalance, {\n    bold: false,\n    start: cachedUsersBalance || usersTokenBalance,\n    end: numberWithCommas(usersTokenBalance, {\n      precision: 4\n    }),\n    units: tickerUpcased\n  }), __jsx(\"div\", {\n    className: \"bg-primary flex text-inverse items-center justify-between w-full mx-auto px-6 py-3 font-bold rounded-bl-lg rounded-br-lg\"\n  }, __jsx(\"div\", null, t('total')), __jsx(\"div\", null, __jsx(PoolNumber, null, numberWithCommas(quantity, {\n    precision: 4\n  })), \" \", tickerUpcased))), __jsx(\"div\", {\n    className: \"flex flex-col mx-auto w-full mx-auto items-center justify-center\"\n  }, overBalance ? __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"text-orange my-6 flex flex-col\"\n  }, __jsx(\"h4\", {\n    className: \"\"\n  }, t('youDontHaveEnoughTicker', {\n    ticker: tickerUpcased\n  })), __jsx(\"div\", {\n    className: \"mt-2 text-default-soft\"\n  }, __jsx(WyreTopUpBalanceDropdown, {\n    showSuggestion: true,\n    label: __jsx(Trans, {\n      i18nKey: \"topUpBalance\",\n      defaults: \"<visibleMobile>Buy crypto</visibleMobile><hiddenMobile>Buy more crypto</hiddenMobile>\",\n      components: {\n        visibleMobile: __jsx(\"span\", {\n          className: \"xs:hidden ml-1\"\n        }),\n        hiddenMobile: __jsx(\"span\", {\n          className: \"hidden xs:inline-block ml-1\"\n        })\n      }\n    }),\n    textColor: \"text-highlight-2\",\n    hoverTextColor: \"text-highlight-1\",\n    className: \"button-scale mt-4 mb-20 px-10 py-2 text-sm sm:text-xl lg:text-2xl rounded-lg border-highlight-2 border-2 bg-default hover:border-highlight-1 hover:bg-body\",\n    tickerUpcased: tickerUpcased,\n    usersAddress: usersAddress\n  })), __jsx(ButtonDrawer, null, __jsx(Button, {\n    secondary: true,\n    textSize: \"lg\",\n    onClick: previousStep,\n    className: \"mt-2 inline-flex items-center mx-auto\"\n  }, __jsx(FeatherIcon, {\n    icon: \"arrow-left\",\n    className: \"relative stroke-current w-4 h-4 sm:w-6 sm:h-6 lg:w-8 lg:h-8 mr-2\",\n    style: {\n      top: 1\n    }\n  }), \" \", t('changeQuantity')), __jsx(\"div\", null)))) : __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"text-inverse mb-4 text-lg w-full\"\n  }, needsApproval && __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"text-sm mb-6 px-6 sm:px-10\",\n    style: {\n      minHeight: 97\n    }\n  }, !unlockTxInFlight && __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"pt-6\"\n  }, __jsx(PaneTitle, {\n    small: true\n  }, needsApproval && t('yourApprovalIsNecessary'), (tx === null || tx === void 0 ? void 0 : tx.inWallet) && !(tx === null || tx === void 0 ? void 0 : tx.cancelled) && t('confirmApprovalInWallet')))), !unlockTxInFlight && needsApproval && __jsx(React.Fragment, null, __jsx(\"span\", {\n    className: \"font-bold\"\n  }, t('unlockToDepositTicker', {\n    ticker: tickerUpcased\n  }))), (tx === null || tx === void 0 ? void 0 : tx.sent) && !(tx === null || tx === void 0 ? void 0 : tx.completed) && __jsx(TransactionsTakeTimeMessage, {\n    tx: tx,\n    paneMessage: t('approvalConfirming')\n  }))), __jsx(ButtonDrawer, null, !needsApproval ? __jsx(React.Fragment, null, __jsx(PTHint, {\n    title: t('allowance'),\n    tip: __jsx(React.Fragment, null, __jsx(\"div\", {\n      className: \"my-2 text-xs sm:text-sm\"\n    }, t('youHaveProvidedEnoughAllowance'))),\n    className: \"w-48-percent\"\n  }, approveButton)) : approveButton, __jsx(DepositTxButton, {\n    needsApproval: needsApproval,\n    quantity: quantity,\n    disabled: poolIsLocked || needsApproval || overBalance,\n    poolIsLocked: poolIsLocked,\n    nextStep: nextStep\n  }))))));\n}\n\n_s(DepositCryptoForm, \"8JsP0rZVyviZPFFF6vhzv0P6rVw=\", false, function () {\n  return [useTranslation, useAtom, useRouter, useSendTransaction];\n});\n\n_c = DepositCryptoForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"DepositCryptoForm\");","map":{"version":3,"sources":["/Users/chuckbergeron/Git/crypto/pool-together/pool-app/lib/components/DepositCryptoForm.jsx"],"names":["React","useContext","useEffect","useState","FeatherIcon","ethers","useRouter","useAtom","IERC20Abi","Trans","useTranslation","AuthControllerContext","PoolDataContext","transactionsAtom","Button","ButtonDrawer","DepositTxButton","DepositFormUsersBalance","PaneTitle","PoolNumber","PoolCurrencyIcon","PTHint","TransactionsTakeTimeMessage","WyreTopUpBalanceDropdown","useSendTransaction","numberWithCommas","usersDataForPool","DepositCryptoForm","props","t","transactions","setTransactions","nextStep","previousStep","router","quantity","query","usersAddress","provider","pool","usersChainData","decimals","underlyingCollateralDecimals","tokenAddress","underlyingCollateralToken","ticker","underlyingCollateralSymbol","poolAddress","tickerUpcased","toUpperCase","needsApproval","setNeedsApproval","cachedUsersBalance","setCachedUsersBalance","poolIsLocked","isRngRequested","quantityBN","utils","bigNumberify","parseUnits","Number","usersTokenBalanceBN","usersTokenBalance","usersTokenAllowance","gt","gte","overBalance","lt","txId","setTxId","txName","method","sendTx","tx","find","id","unlockTxInFlight","cancelled","inWallet","sent","handleUnlockClick","e","preventDefault","params","approveButtonClassName","approveButton","top","number","amount","precision","visibleMobile","hiddenMobile","minHeight","completed"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\nimport FeatherIcon from 'feather-icons-react'\nimport { ethers } from 'ethers'\nimport { useRouter } from 'next/router'\nimport { useAtom } from 'jotai'\n\nimport IERC20Abi from '@pooltogether/pooltogether-contracts/abis/IERC20'\n\nimport { Trans, useTranslation } from 'lib/../i18n'\nimport { AuthControllerContext } from 'lib/components/contextProviders/AuthControllerContextProvider'\nimport { PoolDataContext } from 'lib/components/contextProviders/PoolDataContextProvider'\nimport { transactionsAtom } from 'lib/atoms/transactionsAtom'\nimport { Button } from 'lib/components/Button'\nimport { ButtonDrawer } from 'lib/components/ButtonDrawer'\nimport { DepositTxButton } from 'lib/components/DepositTxButton'\nimport { DepositFormUsersBalance } from 'lib/components/DepositFormUsersBalance'\nimport { PaneTitle } from 'lib/components/PaneTitle'\nimport { PoolNumber } from 'lib/components/PoolNumber'\nimport { PoolCurrencyIcon } from 'lib/components/PoolCurrencyIcon'\nimport { PTHint } from 'lib/components/PTHint'\nimport { TransactionsTakeTimeMessage } from 'lib/components/TransactionsTakeTimeMessage'\nimport { WyreTopUpBalanceDropdown } from 'lib/components/WyreTopUpBalanceDropdown'\nimport { useSendTransaction } from 'lib/hooks/useSendTransaction'\nimport { numberWithCommas } from 'lib/utils/numberWithCommas'\nimport { usersDataForPool } from 'lib/utils/usersDataForPool'\n// import { poolTokenSupportsPermitSign } from 'lib/utils/poolTokenSupportsPermitSign'\n\nexport function DepositCryptoForm(props) {\n  const { t } = useTranslation()\n\n  const [transactions, setTransactions] = useAtom(transactionsAtom)\n\n  const { nextStep, previousStep } = props\n\n  const router = useRouter()\n  const quantity = router.query.quantity\n  \n  const { usersAddress, provider } = useContext(AuthControllerContext)\n  const { pool, usersChainData } = useContext(PoolDataContext)\n\n  const decimals = pool?.underlyingCollateralDecimals\n  const tokenAddress = pool?.underlyingCollateralToken\n  const ticker = pool?.underlyingCollateralSymbol\n  const poolAddress = pool?.poolAddress\n  \n  const tickerUpcased = ticker?.toUpperCase()\n\n  const [needsApproval, setNeedsApproval] = useState(true)\n  const [cachedUsersBalance, setCachedUsersBalance] = useState()\n\n  const poolIsLocked = pool?.isRngRequested\n\n  let quantityBN = ethers.utils.bigNumberify(0)\n  if (decimals) {\n    quantityBN = ethers.utils.parseUnits(\n      quantity || '0',\n      Number(decimals)\n    )\n  }\n\n  const {\n    usersTokenBalanceBN,\n    usersTokenBalance,\n    usersTokenAllowance,\n  } = usersDataForPool(pool, usersChainData)\n\n  useEffect(() => {\n    setCachedUsersBalance(usersTokenBalance)\n  }, [usersTokenBalance])\n\n  useEffect(() => {\n    if (\n      // poolTokenSupportsPermitSign(chainId, tokenAddress) ||\n      (\n        quantityBN.gt(0) &&\n        usersTokenAllowance.gte(quantityBN)\n      )\n    ) {\n      setNeedsApproval(false)\n    } else {\n      setNeedsApproval(true)\n    }\n  }, [quantityBN, usersTokenAllowance])\n\n  \n\n  let overBalance = false\n  if (decimals) {\n    overBalance = quantity && usersTokenBalanceBN.lt(\n      ethers.utils.parseUnits(\n        quantity,\n        Number(decimals)\n      )\n    )\n  }\n\n  const [txId, setTxId] = useState()\n\n  const txName = t(`allowTickerPool`, { ticker: tickerUpcased })\n  const method = 'approve'\n\n  const [sendTx] = useSendTransaction(txName, transactions, setTransactions)\n\n  \n  \n  const tx = transactions?.find((tx) => tx.id === txId)\n\n  const unlockTxInFlight = !tx?.cancelled && (tx?.inWallet || tx?.sent)\n\n  const handleUnlockClick = async (e) => {\n    e.preventDefault()\n\n    const params = [\n      poolAddress,\n      ethers.utils.parseUnits('9999999999', Number(decimals)),\n      // ethers.utils.parseUnits(\n      //   quantity,\n      //   Number(decimals)\n      // ),\n      // {\n      //   gasLimit: 200000\n      // }\n    ]\n\n    const id = sendTx(\n      t,\n      provider,\n      usersAddress,\n      IERC20Abi,\n      tokenAddress,\n      method,\n      params,\n    )\n    \n    setTxId(id)\n  }\n\n  const approveButtonClassName = !needsApproval ? 'w-full' : 'w-48-percent'\n\n  const approveButton = <Button\n    textSize='lg'\n    onClick={handleUnlockClick}\n    disabled={!needsApproval || unlockTxInFlight}\n    className={approveButtonClassName}\n  >\n    {!needsApproval && <>\n      <FeatherIcon\n        strokeWidth='0.25rem'\n        icon='check'\n        className='inline-block relative w-5 h-5 ml-auto mr-1'\n        style={{\n          top: '-0.05rem'\n        }}\n      />\n    </>} {t('allowTicker', {\n      ticker: tickerUpcased\n    })}\n  </Button>\n\n  return <>\n    <PaneTitle short>\n      <div className='inline-block sm:block relative -t-1 -mr-2'>\n        <PoolCurrencyIcon\n          pool={pool}\n        />\n      </div> {t('depositTicker', {\n        ticker: tickerUpcased\n      })}\n    </PaneTitle>\n\n    <div className='mb-6 -mt-2'>\n      <PaneTitle small>\n        <Trans\n          i18nKey='amountTickets'\n          defaults='<number>{{amount}}</number> tickets'\n          components={{\n            number: <PoolNumber />,\n          }}\n          values={{\n            amount: quantity,\n          }}\n        />\n      </PaneTitle>\n    </div>\n\n    \n\n    <div\n      className='text-sm xs:text-base sm:text-lg lg:text-xl'\n    >\n      <DepositFormUsersBalance\n        bold={false}\n        start={cachedUsersBalance || usersTokenBalance}\n        end={numberWithCommas(usersTokenBalance, { precision: 4 })}\n        units={tickerUpcased}\n      />\n\n      <div\n        className='bg-primary flex text-inverse items-center justify-between w-full mx-auto px-6 py-3 font-bold rounded-bl-lg rounded-br-lg'\n      >\n        <div>\n          {t('total')}\n        </div>\n        <div>\n          <PoolNumber>\n            {numberWithCommas(quantity, { precision: 4 })}\n          </PoolNumber> {tickerUpcased}\n        </div>\n      </div>\n    </div>\n\n    <div\n      className='flex flex-col mx-auto w-full mx-auto items-center justify-center'\n    >\n      \n      {overBalance ? <>\n        <div className='text-orange my-6 flex flex-col'>\n          <h4\n            className=''\n          >\n            {t('youDontHaveEnoughTicker', {\n              ticker: tickerUpcased\n            })}\n          </h4>\n          <div\n            className='mt-2 text-default-soft'\n          >\n            <WyreTopUpBalanceDropdown\n              showSuggestion\n              label={<Trans\n                i18nKey='topUpBalance'\n                defaults='<visibleMobile>Buy crypto</visibleMobile><hiddenMobile>Buy more crypto</hiddenMobile>'\n                components={{\n                  visibleMobile: <span\n                    className='xs:hidden ml-1'\n                  />,\n                  hiddenMobile: <span\n                    className='hidden xs:inline-block ml-1'\n                  />\n                }}\n              />}\n              textColor='text-highlight-2'\n              hoverTextColor='text-highlight-1'\n              className='button-scale mt-4 mb-20 px-10 py-2 text-sm sm:text-xl lg:text-2xl rounded-lg border-highlight-2 border-2 bg-default hover:border-highlight-1 hover:bg-body'\n              tickerUpcased={tickerUpcased}\n              usersAddress={usersAddress}\n            />\n          </div>\n\n          <ButtonDrawer>\n            <Button\n              secondary\n              textSize='lg'\n              onClick={previousStep}\n              className='mt-2 inline-flex items-center mx-auto'\n            >\n              <FeatherIcon\n                icon='arrow-left'\n                className='relative stroke-current w-4 h-4 sm:w-6 sm:h-6 lg:w-8 lg:h-8 mr-2'\n                style={{\n                  top: 1\n                }}\n              /> {t('changeQuantity')}\n            </Button>\n            <div></div>\n          </ButtonDrawer>\n          \n          \n        </div>\n      </> : <>\n        <div\n          className='text-inverse mb-4 text-lg w-full'\n        >\n\n          {needsApproval && <>\n            <div\n              className='text-sm mb-6 px-6 sm:px-10'\n              style={{\n                minHeight: 97\n              }}\n            >\n              {!unlockTxInFlight && <>\n                <div\n                  className='pt-6'\n                >\n                  <PaneTitle small>\n                    {needsApproval && t('yourApprovalIsNecessary')}\n\n                    {/* could say in Coinbase Wallet or MetaMask or whatever here ... */}\n                    {tx?.inWallet && !tx?.cancelled && t('confirmApprovalInWallet')}\n                  </PaneTitle>\n                </div>\n              </>}\n\n              {!unlockTxInFlight && needsApproval && <>\n                <span className='font-bold'>\n                  {t('unlockToDepositTicker', {\n                    ticker: tickerUpcased\n                  })}\n                </span>\n              </>}\n\n              {tx?.sent && !tx?.completed && <TransactionsTakeTimeMessage\n                tx={tx}\n                paneMessage={t('approvalConfirming')}\n              />}\n            </div>\n          </>}\n          \n          <ButtonDrawer>\n            {!needsApproval ? <>\n              <PTHint\n                title={t('allowance')}\n                tip={<>\n                  <div className='my-2 text-xs sm:text-sm'>\n                    {t('youHaveProvidedEnoughAllowance')}\n                  </div>\n                </>}\n                className='w-48-percent'\n              >\n                {approveButton}\n              </PTHint>\n            </> : approveButton}\n\n            \n\n            <DepositTxButton\n              needsApproval={needsApproval}\n              quantity={quantity}\n              disabled={poolIsLocked || needsApproval || overBalance}\n              poolIsLocked={poolIsLocked}\n              nextStep={nextStep}\n            />\n          </ButtonDrawer>\n        </div>\n      </>}\n    </div>\n  </>\n}\n"]},"metadata":{},"sourceType":"module"}