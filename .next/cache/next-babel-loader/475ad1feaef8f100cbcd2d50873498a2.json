{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useContext, useEffect, useState } from 'react';\nimport { useRouter } from 'next/router';\nimport { useTranslation } from 'lib/../i18n';\nimport { AuthControllerContext } from 'lib/components/contextProviders/AuthControllerContextProvider';\nimport { PoolDataContext } from 'lib/components/contextProviders/PoolDataContextProvider';\nimport { Button } from 'lib/components/Button';\nimport { Modal } from 'lib/components/Modal';\nimport { usePrizeQuery } from 'lib/hooks/usePrizeQuery';\nimport PrizeIllustration from 'assets/images/prize-illustration-new@2x.png';\n\nvar debug = require('debug')('pool-app:NewPrizeWinnerEventListener');\n\nexport function NewPrizeWinnerEventListener(props) {\n  _s();\n\n  var _recentPrize$winners, _winner;\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var router = useRouter();\n\n  var _useState = useState(null),\n      cachedChainId = _useState[0],\n      setCachedChainId = _useState[1];\n\n  var _useState2 = useState(null),\n      storedRecentPrizeId = _useState2[0],\n      setStoredRecentPrizeId = _useState2[1];\n\n  var _useState3 = useState(null),\n      newPrizeModalVisible = _useState3[0],\n      setNewPrizeModalVisible = _useState3[1];\n\n  var _useContext = useContext(AuthControllerContext),\n      chainId = _useContext.chainId,\n      pauseQueries = _useContext.pauseQueries,\n      usersAddress = _useContext.usersAddress;\n\n  var _useContext2 = useContext(PoolDataContext),\n      pools = _useContext2.pools; // TODO: Expand this to work for every pool!\n\n\n  var pool = pools === null || pools === void 0 ? void 0 : pools[0];\n  var recentPrizeId = (pool === null || pool === void 0 ? void 0 : pool.currentPrizeId) - 1;\n  var prizeId = \"\".concat(pool === null || pool === void 0 ? void 0 : pool.poolAddress, \"-\").concat(recentPrizeId);\n\n  var _usePrizeQuery = usePrizeQuery(pauseQueries, chainId, pool, prizeId),\n      status = _usePrizeQuery.status,\n      data = _usePrizeQuery.data,\n      error = _usePrizeQuery.error,\n      isFetching = _usePrizeQuery.isFetching;\n\n  var recentPrize = data === null || data === void 0 ? void 0 : data.prize;\n  useEffect(function () {\n    if (recentPrizeId && storedRecentPrizeId !== recentPrizeId) {\n      debug('setting new stored prize count! prize awarded?');\n      setStoredRecentPrizeId(recentPrizeId);\n    }\n\n    if (!newPrizeModalVisible && storedRecentPrizeId !== null && storedRecentPrizeId !== recentPrizeId) {\n      debug('storedRecentPrizeId', storedRecentPrizeId);\n      debug('showingModal!');\n      setNewPrizeModalVisible(true);\n    }\n  }, [pool]);\n  useEffect(function () {\n    if (chainId !== cachedChainId) {\n      debug('clearing state!');\n      setNewPrizeModalVisible(false);\n      setStoredRecentPrizeId(null);\n      setCachedChainId(chainId);\n    }\n  }, [chainId]);\n\n  if (recentPrizeId === 0 || !recentPrize || !storedRecentPrizeId) {\n    debug('returning null because one of these is true', recentPrizeId === 0, !recentPrize, !storedRecentPrizeId);\n    return null;\n  }\n\n  var handleClose = function handleClose(e) {\n    e.preventDefault();\n    setNewPrizeModalVisible(false);\n  };\n\n  var winner;\n\n  if ((recentPrize === null || recentPrize === void 0 ? void 0 : (_recentPrize$winners = recentPrize.winners) === null || _recentPrize$winners === void 0 ? void 0 : _recentPrize$winners.length) > 0) {\n    winner = data.prize.winners[0];\n  }\n\n  var isWinner = ((_winner = winner) === null || _winner === void 0 ? void 0 : _winner.toLowerCase()) === (usersAddress === null || usersAddress === void 0 ? void 0 : usersAddress.toLowerCase());\n  var recentPrizeAwarded = recentPrize.awardedTimestamp;\n  debug('newPrizeModalVisible', newPrizeModalVisible);\n  debug('Boolean(recentPrizeAwarded)', Boolean(recentPrizeAwarded));\n  var show = newPrizeModalVisible && Boolean(recentPrizeAwarded) && !isNaN(recentPrizeId);\n  return __jsx(React.Fragment, null, __jsx(Modal, {\n    handleClose: handleClose,\n    visible: show,\n    header: __jsx(React.Fragment, null, t('aPrizeHasBeenAwarded'))\n  }, __jsx(\"img\", {\n    src: PrizeIllustration,\n    className: \"w-1/2 sm:w-1/2 lg:w-1/3 mx-auto\"\n  }), !usersAddress && __jsx(React.Fragment, null, t('connectAWalletToSeeIfYouWon')), usersAddress && __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"mt-4\"\n  }, isWinner ? __jsx(React.Fragment, null, __jsx(\"h4\", {\n    className: \"text-flashy\"\n  }, t('youWon'))) : __jsx(React.Fragment, null, __jsx(\"h4\", null, t('unfortunatelyYouDidntWinThisOne')), __jsx(\"h6\", null, t('tryAgainNextWeek'))))), __jsx(\"div\", {\n    className: \"mt-4\"\n  }, __jsx(Button, {\n    secondary: true,\n    onClick: function onClick(e) {\n      e.preventDefault();\n      setNewPrizeModalVisible(false);\n      var href = '/prizes/[symbol]/[prizeNumber]';\n      var as = \"/prizes/\".concat(pool === null || pool === void 0 ? void 0 : pool.symbol, \"/\").concat((pool === null || pool === void 0 ? void 0 : pool.currentPrizeId) - 1);\n\n      if (!usersAddress) {\n        href = \"\".concat(href, \"?signIn=1\");\n        as = \"\".concat(as, \"?signIn=1\");\n      }\n\n      router.push(href, as, {\n        shallow: true\n      });\n    }\n  }, t('viewPrize')))));\n}\n\n_s(NewPrizeWinnerEventListener, \"BKaDxar9c4E7DQWM3088S4DePN8=\", false, function () {\n  return [useTranslation, useRouter, usePrizeQuery];\n});\n\n_c = NewPrizeWinnerEventListener;\n\nvar _c;\n\n$RefreshReg$(_c, \"NewPrizeWinnerEventListener\");","map":{"version":3,"sources":["/Users/chuckbergeron/Git/crypto/pool-together/pool-app/lib/components/NewPrizeWinnerEventListener.jsx"],"names":["useContext","useEffect","useState","useRouter","useTranslation","AuthControllerContext","PoolDataContext","Button","Modal","usePrizeQuery","PrizeIllustration","debug","require","NewPrizeWinnerEventListener","props","t","router","cachedChainId","setCachedChainId","storedRecentPrizeId","setStoredRecentPrizeId","newPrizeModalVisible","setNewPrizeModalVisible","chainId","pauseQueries","usersAddress","pools","pool","recentPrizeId","currentPrizeId","prizeId","poolAddress","status","data","error","isFetching","recentPrize","prize","handleClose","e","preventDefault","winner","winners","length","isWinner","toLowerCase","recentPrizeAwarded","awardedTimestamp","Boolean","show","isNaN","href","as","symbol","push","shallow"],"mappings":"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","sourcesContent":["import { useContext, useEffect, useState } from 'react'\nimport { useRouter } from 'next/router'\n\nimport { useTranslation } from 'lib/../i18n'\nimport { AuthControllerContext } from 'lib/components/contextProviders/AuthControllerContextProvider'\nimport { PoolDataContext } from 'lib/components/contextProviders/PoolDataContextProvider'\nimport { Button } from 'lib/components/Button'\nimport { Modal } from 'lib/components/Modal'\nimport { usePrizeQuery } from 'lib/hooks/usePrizeQuery'\n\nimport PrizeIllustration from 'assets/images/prize-illustration-new@2x.png'\n\nconst debug = require('debug')('pool-app:NewPrizeWinnerEventListener')\n\nexport function NewPrizeWinnerEventListener(props) {\n  const { t } = useTranslation()\n  const router = useRouter()\n\n  const [cachedChainId, setCachedChainId] = useState(null)\n  const [storedRecentPrizeId, setStoredRecentPrizeId] = useState(null)\n  const [newPrizeModalVisible, setNewPrizeModalVisible] = useState(null)\n\n  const { chainId, pauseQueries, usersAddress } = useContext(AuthControllerContext)\n  const { pools } = useContext(PoolDataContext)\n\n  // TODO: Expand this to work for every pool!\n  const pool = pools?.[0]\n\n  const recentPrizeId = pool?.currentPrizeId - 1\n\n  const prizeId = `${pool?.poolAddress}-${recentPrizeId}`\n\n  const { status, data, error, isFetching } = usePrizeQuery(pauseQueries, chainId, pool, prizeId)\n  \n  const recentPrize = data?.prize\n  \n  useEffect(() => {\n    if (recentPrizeId && storedRecentPrizeId !== recentPrizeId) {\n      debug('setting new stored prize count! prize awarded?')\n      setStoredRecentPrizeId(recentPrizeId)\n    }\n\n    if (!newPrizeModalVisible && storedRecentPrizeId !== null && storedRecentPrizeId !== recentPrizeId) {\n      debug('storedRecentPrizeId', storedRecentPrizeId)\n      debug('showingModal!')\n      setNewPrizeModalVisible(true)\n    }\n  }, [pool])\n\n\n  useEffect(() => {\n    if (chainId !== cachedChainId) {\n      debug('clearing state!')\n      setNewPrizeModalVisible(false)\n      setStoredRecentPrizeId(null)\n      setCachedChainId(chainId)\n    }\n  }, [chainId])\n\n\n  if (recentPrizeId === 0 || !recentPrize || !storedRecentPrizeId) {\n    debug('returning null because one of these is true', recentPrizeId === 0, !recentPrize, !storedRecentPrizeId)\n    return null\n  }\n\n\n\n  const handleClose = (e) => {\n    e.preventDefault()\n\n    setNewPrizeModalVisible(false)\n  }\n\n  let winner\n  if (recentPrize?.winners?.length > 0) {\n    winner = data.prize.winners[0]\n  }\n  const isWinner = winner?.toLowerCase() === usersAddress?.toLowerCase()\n\n  const recentPrizeAwarded = recentPrize.awardedTimestamp\n  debug('newPrizeModalVisible', newPrizeModalVisible)\n  debug('Boolean(recentPrizeAwarded)', Boolean(recentPrizeAwarded))\n\n  const show = newPrizeModalVisible && Boolean(recentPrizeAwarded) && !isNaN(recentPrizeId)\n\n  return <>\n    <Modal\n      handleClose={handleClose}\n      visible={show}\n      header={<>\n        {t('aPrizeHasBeenAwarded')}\n      </>}\n    >\n      <img\n        src={PrizeIllustration}\n        className='w-1/2 sm:w-1/2 lg:w-1/3 mx-auto'\n      />\n\n      {!usersAddress && <>\n        {t('connectAWalletToSeeIfYouWon')}\n      </>}\n\n      {usersAddress && <>\n        <div className='mt-4'>\n          {isWinner ? <>\n            <h4\n              className='text-flashy'\n            >\n              {t('youWon')}\n            </h4>\n          </> : <>\n            <h4\n            >\n              {t('unfortunatelyYouDidntWinThisOne')}\n            </h4>\n            <h6\n            >\n              {t('tryAgainNextWeek')}\n            </h6>\n          </>}\n        </div>\n      </>}\n\n      <div className='mt-4'>\n        <Button\n          secondary\n          onClick={(e) => {\n            e.preventDefault()\n\n            setNewPrizeModalVisible(false)\n\n            let href = '/prizes/[symbol]/[prizeNumber]'\n            let as = `/prizes/${pool?.symbol}/${pool?.currentPrizeId - 1}`\n\n            if (!usersAddress) {\n              href = `${href}?signIn=1`\n              as = `${as}?signIn=1`\n            }\n\n            router.push(\n              href,\n              as,\n              { shallow: true }\n            )\n          }}\n        >\n          {t('viewPrize')}\n        </Button>\n      </div>\n    </Modal>\n  </>\n}\n"]},"metadata":{},"sourceType":"module"}